<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem 3: Spanning Tree Protocol (STP) Loops - Admin Guide</title>
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <!-- Custom Cursor -->
    <div class="cursor" id="cursor"></div>
    <div class="cursor-outline" id="cursorOutline"></div>

    <div class="container">
        <header class="header header-l2">
            <!-- Language Switcher -->
            <div class="language-switcher">
                <a href="description.html" class="lang-btn">üáπüá∑ T√ºrk√ße</a>
                <a href="description-en.html" class="lang-btn active">üá∫üá∏ English</a>
            </div>
            
            <h1>üü¢ Problem 3: Spanning Tree Protocol (STP) Loops</h1>
            <p>L2 - Data Link Layer - Admin Guide Tutorial</p>
        </header>

        <nav class="breadcrumb">
            <a href="../../index.html">Home</a> &gt;
            <a href="#">Problem 3: STP Loops</a>
        </nav>

        <main class="content">
            <section class="section">
                <h2>Problem Definition: STP and Network Loops</h2>
                <p>
                    Spanning Tree Protocol (STP) is a network protocol designed to prevent broadcast storms and MAC address table instabilities in Layer 2 topologies with redundant links (containing loops). STP creates a logically loop-free path in the network by placing certain ports into "blocking" mode.
                </p>
                <p>
                    <strong>STP Loop Problem</strong> occurs when STP is not working properly or is misconfigured. In this case, physical loops in the network become active, leading to destructive broadcast storms.
                </p>
                <div class="danger-box">
                    <strong>Critical Danger:</strong> An STP loop can consume all bandwidth in the network within seconds and make all network devices (switches, routers, servers) inaccessible.
                </div>
            </section>
            
            <section class="section">
                <h2>üñºÔ∏è Network Topology Causing Loops (Example Diagram)</h2>
                <p>Below is an example of a broadcast storm that occurs when STP is disabled. You can see that in a triangle topology where three switches are connected and without STP, ping tests fail:</p>
                
                <!-- Interactive STP Loop Animation -->
                <div class="svg-animation-container" id="stpAnimation">
                    <h3 style="text-align: center; margin-bottom: 1rem; color: var(--accent-teal);">üîÑ Interactive STP Loop Prevention Animation</h3>
                    <svg viewBox="0 0 800 500" style="width: 100%; height: auto; background: #0a192f;">
                        <defs>
                            <linearGradient id="switchGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#3498db"/>
                                <stop offset="100%" stop-color="#2980b9"/>
                            </linearGradient>
                            <filter id="switchGlow">
                                <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        
                        <!-- Background -->
                        <rect width="800" height="500" fill="#112240" opacity="0.3"/>
                        
                        <!-- Network Links -->
                        <line id="link1" x1="200" y1="150" x2="600" y2="150" stroke="#64ffda" stroke-width="6" opacity="0.8"/>
                        <line id="link2" x1="200" y1="150" x2="400" y2="350" stroke="#64ffda" stroke-width="6" opacity="0.8"/>
                        <line id="link3" x1="600" y1="150" x2="400" y2="350" stroke="#64ffda" stroke-width="6" opacity="0.8"/>
                        
                        <!-- Port status indicators -->
                        <circle id="port1A" cx="220" cy="150" r="8" fill="#2ecc71"/>
                        <circle id="port1B" cx="580" cy="150" r="8" fill="#2ecc71"/>
                        <circle id="port2A" cx="210" cy="170" r="8" fill="#2ecc71"/>
                        <circle id="port2C" cx="390" cy="330" r="8" fill="#2ecc71"/>
                        <circle id="port3B" cx="590" cy="170" r="8" fill="#2ecc71"/>
                        <circle id="port3C" cx="410" cy="330" r="8" fill="#2ecc71"/>
                        
                        <!-- Switches -->
                        <!-- Switch A (Root Bridge) -->
                        <rect x="150" y="120" width="100" height="60" rx="10" fill="url(#switchGradient)" 
                              stroke="#64ffda" stroke-width="3" filter="url(#switchGlow)" id="switchA"/>
                        <text x="200" y="140" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Switch A</text>
                        <text x="200" y="155" text-anchor="middle" fill="#f1c40f" font-size="10" font-weight="bold" id="roleA">ROOT BRIDGE</text>
                        <text x="200" y="170" text-anchor="middle" fill="white" font-size="8" id="statusA">STP: ENABLED</text>
                        
                        <!-- Switch B -->
                        <rect x="550" y="120" width="100" height="60" rx="10" fill="url(#switchGradient)" 
                              stroke="#64ffda" stroke-width="3" filter="url(#switchGlow)" id="switchB"/>
                        <text x="600" y="140" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Switch B</text>
                        <text x="600" y="155" text-anchor="middle" fill="#2ecc71" font-size="10" font-weight="bold" id="roleB">DESIGNATED</text>
                        <text x="600" y="170" text-anchor="middle" fill="white" font-size="8" id="statusB">STP: ENABLED</text>
                        
                        <!-- Switch C -->
                        <rect x="350" y="320" width="100" height="60" rx="10" fill="url(#switchGradient)" 
                              stroke="#64ffda" stroke-width="3" filter="url(#switchGlow)" id="switchC"/>
                        <text x="400" y="340" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Switch C</text>
                        <text x="400" y="355" text-anchor="middle" fill="#2ecc71" font-size="10" font-weight="bold" id="roleC">DESIGNATED</text>
                        <text x="400" y="370" text-anchor="middle" fill="white" font-size="8" id="statusC">STP: ENABLED</text>
                        
                        <!-- Broadcast Packet -->
                        <circle id="broadcastPacket" cx="200" cy="150" r="10" fill="#ff6b6b" opacity="0">
                            <animate attributeName="r" values="8;12;8" dur="0.5s" repeatCount="indefinite"/>
                        </circle>
                        <text x="200" y="120" text-anchor="middle" fill="#ff6b6b" font-size="10" font-weight="bold" opacity="0" id="packetLabel">BROADCAST</text>
                        
                        <!-- Blocked Port Indicator -->
                        <text x="400" y="280" text-anchor="middle" fill="#e74c3c" font-size="12" font-weight="bold" opacity="0" id="blockedText">PORT BLOCKED</text>
                        <line x1="580" y1="140" x2="420" y2="340" stroke="#e74c3c" stroke-width="8" opacity="0" id="blockedLine"/>
                        
                        <!-- Status Display -->
                        <rect x="50" y="400" width="700" height="80" rx="10" fill="#112240" stroke="#64ffda" stroke-width="2"/>
                        <text x="70" y="420" fill="#64ffda" font-size="14" font-weight="bold">Network Status:</text>
                        <text x="70" y="440" fill="#2ecc71" font-size="12" id="networkStatus">Phase 1: Normal Operation - All ports forwarding</text>
                        <text x="70" y="455" fill="#f39c12" font-size="10" id="stpStatus">STP Convergence: Stable</text>
                        <text x="70" y="470" fill="#95a5a6" font-size="10" id="loopStatus">Loop Prevention: Active</text>
                        
                        <!-- Legend -->
                        <text x="50" y="40" fill="#64ffda" font-size="14" font-weight="bold">STP Loop Prevention Simulation</text>
                        <text x="50" y="60" fill="#2ecc71" font-size="10">üü¢ Normal Port | üî¥ Blocked Port | üì° Broadcast Packet</text>
                    </svg>
                    <p style="text-align: center; margin-top: 1rem; color: var(--text-secondary); font-style: italic;">
                        Scroll down to watch the STP loop prevention mechanism
                    </p>
                </div>
                
                <div class="image-container">
                    <img src="../../images/screenshots/stp_ping_failure.png" alt="STP Loop - Ping Failed" class="screenshot">
                    <figcaption>Figure 1: Failed ping test due to broadcast storm when STP is disabled</figcaption>
                </div>
                
                <h4>Packet Tracer Simulation File:</h4>
                <p>You can download the Packet Tracer file containing the simulation of this STP loop problem <a href="packet_tracer/stp_problem.pkt" download>here</a>.</p>
                
                <p><strong>Additional Files:</strong></p>
                <ul>
                    <li><a href="packet_tracer/stp_normal.pkt" download>stp_normal.pkt</a> - Normal STP operation state</li>
                    <li><a href="packet_tracer/stp_solution.pkt" download>stp_solution.pkt</a> - Solution file</li>
                </ul>
            </section>

            <section class="section">
                <h2>Common Causes of STP Loops</h2>
                <ul>
                    <li><strong>Incorrect Root Bridge Selection:</strong> Selecting a low-capacity switch as Root Bridge can cause traffic to flow through suboptimal paths and certain ports to be blocked unexpectedly.</li>
                    <li><strong>Disabling STP:</strong> Intentionally or accidentally disabling STP on a switch or port.</li>
                    <li><strong>PortFast Errors:</strong> PortFast feature is used on ports connected to host devices like servers or PCs. However, if a switch or hub is accidentally connected to these ports, temporary loops can occur. BPDU Guard is used to prevent this situation.</li>
                    <li><strong>Unidirectional Link Failures:</strong> This is a common situation in fiber optic connections. When one of the two fibers breaks, a switch may still think the link is "up" and cannot send/receive BPDU packets. This leads to STP making wrong decisions.</li>
                    <li><strong>Timer Mismatches:</strong> Inconsistency of STP hello, forward delay, and max age timers network-wide.</li>
                </ul>
            </section>

            <section class="section">
                <h2>Symptoms and Detection Methods</h2>
                <h3>Network Symptoms:</h3>
                <ul>
                    <li>Network-wide extreme slowness or complete loss of access.</li>
                    <li>Switch and router CPU usage rates reaching 90-100% levels.</li>
                    <li>Activity lights on switches blinking excessively fast and continuously.</li>
                    <li>Constant changes in MAC address tables of network devices (MAC flapping).</li>
                </ul>

                <h3>Cisco IOS Commands for Detection:</h3>
                <div class="code-block">
                    <pre><span class="comment"># Check a switch's STP status and Root Bridge information</span>
<span class="command">Switch# show spanning-tree</span>

<span class="comment"># View STP status for a specific VLAN</span>
<span class="command">Switch# show spanning-tree vlan 10</span>

<span class="comment"># Check for constant address changes in MAC address table (MAC Flapping)</span>
<span class="command">Switch# show mac address-table</span>

<span class="comment"># Check switch logs to search for STP-related errors</span>
<span class="command">Switch# show logging</span>
</pre>
                </div>
                <div class="info-box">
                    <strong>Tip:</strong> If you suspect a loop, starting with the core/distribution switches in the center of the network and applying the <code>show spanning-tree</code> command is usually the fastest way. Check who the Root Bridge is and the roles of the ports (Root, Designated, Blocking). An unexpected port being in "Forwarding" mode is a sign of a loop.
                </div>
            </section>
            
            <section class="section">
                <h2>Packet Tracer Simulation</h2>
                <div class="packet-tracer-box">
                    <p>To better understand various scenarios of this problem and solution steps, you can examine the related Packet Tracer file. The simulation includes a misconfigured STP topology and the steps required to resolve this issue.</p>
                    <p><strong>Problem File:</strong> <a href="packet_tracer/stp_problem.pkt" class="file-link">stp_problem.pkt</a></p>
                    <p><strong>Normal Operation:</strong> <a href="packet_tracer/stp_normal.pkt" class="file-link">stp_normal.pkt</a></p>
                    <p><strong>Solution File:</strong> <a href="packet_tracer/stp_solution.pkt" class="file-link">stp_solution.pkt</a></p>
                </div>
            </section>
        </main>

        <nav class="navigation">
            <a href="../../index.html" class="nav-button">‚Üê Home</a>
            <a href="solution-en.html" class="nav-button">Solution Details ‚Üí</a>
        </nav>
    </div>

    <!-- GSAP CDN for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    
    <script>
        gsap.registerPlugin(ScrollTrigger);
        
        // STP Loop Prevention Animation
        function initSTPAnimation() {
            const stpContainer = document.getElementById('stpAnimation');
            if (!stpContainer) return;
            
            // Get SVG elements
            const broadcastPacket = document.getElementById('broadcastPacket');
            const packetLabel = document.getElementById('packetLabel');
            const blockedText = document.getElementById('blockedText');
            const blockedLine = document.getElementById('blockedLine');
            const networkStatus = document.getElementById('networkStatus');
            const stpStatus = document.getElementById('stpStatus');
            const loopStatus = document.getElementById('loopStatus');
            const roleC = document.getElementById('roleC');
            const port3B = document.getElementById('port3B');
            const port3C = document.getElementById('port3C');
            
            // Create main timeline
            let mainTL = gsap.timeline({ paused: true });
            
            // Phase 1: Show potential loop scenario
            mainTL.to([broadcastPacket, packetLabel], {
                opacity: 1,
                duration: 0.8,
                ease: "power2.out"
            })
            .call(() => {
                networkStatus.textContent = "Phase 2: Broadcast packet injected into network";
                stpStatus.textContent = "STP Convergence: Analyzing topology...";
            }, [], 0.5)
            
            // Packet travels from A to B
            .to(broadcastPacket, {
                motionPath: {
                    path: "M 200 150 L 600 150",
                    autoRotate: false,
                },
                duration: 1.5,
                ease: "power2.inOut"
            })
            .to(packetLabel, {
                x: 600,
                duration: 1.5,
                ease: "power2.inOut"
            }, "<")
            
            // Packet attempts to go from B to C
            .to(broadcastPacket, {
                motionPath: {
                    path: "M 600 150 L 400 350",
                    autoRotate: false,
                },
                duration: 1.5,
                ease: "power2.inOut"
            })
            .to(packetLabel, {
                x: 400,
                y: 320,
                duration: 1.5,
                ease: "power2.inOut"
            }, "<")
            
            // Show STP blocking decision
            .call(() => {
                networkStatus.textContent = "Phase 3: STP detects potential loop - Blocking port";
                stpStatus.textContent = "STP Convergence: Port blocking initiated";
                loopStatus.textContent = "Loop Prevention: Activating port block";
            }, [], 3.5)
            
            // Show blocked port
            .to([blockedText, blockedLine], {
                opacity: 1,
                duration: 0.8,
                ease: "power2.out"
            })
            .to(port3B, {
                attr: { fill: "#e74c3c" },
                duration: 0.5
            }, "<")
            .to(roleC, {
                attr: { fill: "#e74c3c" },
                duration: 0.3,
                onComplete: () => {
                    roleC.textContent = "BLOCKING";
                }
            }, "<")
            
            // Packet is blocked and cannot continue the loop
            .to(broadcastPacket, {
                scale: 0.5,
                opacity: 0.3,
                duration: 0.8,
                ease: "power2.out"
            })
            .call(() => {
                networkStatus.textContent = "Phase 4: Loop prevented - Network stable";
                stpStatus.textContent = "STP Convergence: Complete";
                loopStatus.textContent = "Loop Prevention: Active - Port B‚ÜíC blocked";
            }, [], 5.5)
            
            // Reset packet position and show successful delivery via allowed path
            .set(broadcastPacket, {
                x: 200,
                y: 150,
                scale: 1,
                opacity: 0.8
            })
            .set(packetLabel, {
                x: 200,
                y: 120
            })
            
            // Show packet taking the allowed path (A‚ÜíC directly)
            .to(broadcastPacket, {
                motionPath: {
                    path: "M 200 150 L 400 350",
                    autoRotate: false,
                },
                duration: 2,
                ease: "power2.inOut"
            })
            .to(packetLabel, {
                x: 400,
                y: 320,
                duration: 2,
                ease: "power2.inOut"
            }, "<")
            
            // Final status
            .call(() => {
                networkStatus.textContent = "Final: Broadcast delivered via loop-free path";
                stpStatus.textContent = "STP Convergence: Stable topology maintained";
            }, [], 7.5)
            
            // Fade out packet
            .to([broadcastPacket, packetLabel], {
                opacity: 0,
                duration: 1,
                ease: "power2.out"
            }, 8.5);
            
            // ScrollTrigger for STP animation
            ScrollTrigger.create({
                trigger: stpContainer,
                start: "top 70%",
                end: "bottom 30%",
                onEnter: () => {
                    mainTL.restart();
                },
                onLeaveBack: () => {
                    resetSTPAnimation();
                }
            });
            
            function resetSTPAnimation() {
                // Reset all elements to initial state
                gsap.set([broadcastPacket, packetLabel, blockedText, blockedLine], { opacity: 0 });
                gsap.set([broadcastPacket, packetLabel], { x: 200, y: 150, scale: 1 });
                gsap.set(packetLabel, { y: 120 });
                gsap.set(port3B, { attr: { fill: "#2ecc71" } });
                gsap.set(roleC, { attr: { fill: "#2ecc71" } });
                
                // Reset text content
                roleC.textContent = "DESIGNATED";
                networkStatus.textContent = "Phase 1: Normal Operation - All ports forwarding";
                stpStatus.textContent = "STP Convergence: Stable";
                loopStatus.textContent = "Loop Prevention: Active";
                
                mainTL.pause(0);
            }
            
            // Add switch pulsing effect during STP operation
            const switches = [
                document.getElementById('switchA'),
                document.getElementById('switchB'),
                document.getElementById('switchC')
            ];
            
            switches.forEach((sw, index) => {
                gsap.to(sw, {
                    scale: 1.05,
                    duration: 2,
                    ease: "sine.inOut",
                    repeat: -1,
                    yoyo: true,
                    delay: index * 0.7
                });
            });
        }
        
        // Initialize animations when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                initSTPAnimation();
            }, 500);
        });
        
        // Custom Cursor System and Page Setup
        document.addEventListener('DOMContentLoaded', function() {
            // Custom Cursor System
            const cursor = document.getElementById('cursor');
            const cursorOutline = document.getElementById('cursorOutline');
            
            if (cursor && cursorOutline) {
                let mouseX = 0, mouseY = 0, outlineX = 0, outlineY = 0;
                
                setTimeout(() => {
                    cursor.style.opacity = '1';
                    cursorOutline.style.opacity = '1';
                }, 500);
                
                document.addEventListener('mousemove', (e) => {
                    mouseX = e.clientX; mouseY = e.clientY;
                    cursor.style.left = mouseX + 'px'; cursor.style.top = mouseY + 'px';
                });
                
                function animateOutline() {
                    outlineX += (mouseX - outlineX) * 0.1; outlineY += (mouseY - outlineY) * 0.1;
                    cursorOutline.style.left = outlineX + 'px'; cursorOutline.style.top = outlineY + 'px';
                    requestAnimationFrame(animateOutline);
                }
                animateOutline();
                
                // Interactive elements hover effects
                document.querySelectorAll('a, button, .nav-button, .lang-btn, .file-link').forEach(element => {
                    element.addEventListener('mouseenter', () => {
                        cursor.classList.add('cursor-hover'); cursorOutline.classList.add('cursor-outline-hover');
                    });
                    element.addEventListener('mouseleave', () => {
                        cursor.classList.remove('cursor-hover'); cursorOutline.classList.remove('cursor-outline-hover');
                    });
                });
            }
            
            // Initialize scroll animations for sections
            const sections = document.querySelectorAll('.section');
            sections.forEach((section, index) => {
                gsap.fromTo(section, {
                    opacity: 0,
                    y: 50
                }, {
                    opacity: 1,
                    y: 0,
                    duration: 0.8,
                    ease: "power3.out",
                    scrollTrigger: {
                        trigger: section,
                        start: "top 85%",
                        once: true
                    }
                });
            });
            
            console.log('üåâ Problem 3: STP Loop Prevention (EN) - Interactive features loaded');
        });
    </script>
</body>
</html> 